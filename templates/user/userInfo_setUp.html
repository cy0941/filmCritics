<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="../../static/css/userInfo_setUp.css" rel="stylesheet" type="text/css">
    <script src="../../static/js/vue.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/headPortrait/css/htmleaf-demo.css">
    <link rel="stylesheet" href="../../static/headPortrait/css/style.css" type="text/css" />
    <link rel="stylesheet" href="../../static/layui/css/layui.css"  media="all">
    <script src="../../static/headPortrait/js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="../../static/css/iconfont.css" type="text/css">
</head>
<body>
    <div class="body">
        <div class="menu">
            设置
        </div>
        <div class="content" id="content">
            <div class="content_left">
                <ul id="c_l">
                    <li @click.prevent="flag='item1'" class="select">
                        <i class="iconfont">&#xe647;</i>修改信息
                    </li>
                    <li @click.prevent="flag='item2'">
                        <i class="iconfont">&#xe67f;</i>修改密码
                    </li>
                    <li @click.prevent="flag='item3'">
                        <i class="iconfont">&#xe644;</i>修改邮箱
                    </li>
                </ul>
            </div>

            <div class="content_right">
                <information v-if="flag=='item1'"></information>
                <password v-if="flag=='item2'"></password>
                <email v-if="flag=='item3'"></email>
            </div>

        </div>
    </div>

    <div id="poplayer">
        <div class="htmleaf-container card">
            <div class="bar_close">
                <span>修改头像</span>
                <span id="close"><i class="iconfont" style="font-size: 24px">&#xe604;</i></span>
            </div>
            <div class="container">
                <div class="imageBox">
                    <div class="thumbBox"></div>
                    <div class="spinner" style="display: none"></div>
                </div>
                <div class="action">
                    <input type="button" id="btnSave" class="Btnsty_peyton layui-btn-disabled" value="保存">
                    <input type="button" id="btnZoomIn" class="Btnsty_peyton" value="+"  >
                    <input type="button" id="btnZoomOut" class="Btnsty_peyton" value="-" >
                    <input type="button" id="btnCrop"  class="Btnsty_peyton" value="裁切">
                </div>
            </div>
            <div class="cropped">
            </div>
        </div>
    </div>

    <template id="information">
        <ul class="information">
            <li>
                <div class="headPortrait" style="background-image: url(../../static/img/img1.jpg)">
                    <div class="modify_headPortrait upload-img">
                        <label for="upload-file">修改图像</label>
                    </div>
                    <input type="file" name="upload-file" id="upload-file" accept='image/*' style="display: none"/>
                </div>
            </li>
            <li>
                <span>昵称：</span>
                <input type="text" placeholder="输入你的新昵称">
                <span></span>
            </li>
            <li>
                <span>账号：</span>
                <span>bili_27819055996</span>
            </li>
            <li>
                <button type="button">保存</button>
            </li>
        </ul>
    </template>

    <template id="password">
        <ul class="flex password">
            <li class="flex">
                <div class="item item_1">（1）验证身份</div>
                <span></span>
                <div class="item item_2">（2）设置密码</div>
                <span></span>
                <div class="item item_3">（3）改密成功</div>
            </li>
            <li class="list" style="display: none">
                <div>
                    <span class="flex">绑定邮箱</span>
                    <input type="text">
                </div>
                <div>
                    <input type="text" placeholder="请输入验证码">
                    <input type="button" value="获取验证码">
                </div>
                <div>
                    <button>下一步</button>
                </div>
            </li>
            <li class="list" style="display: none">
                <div>
                    <span class="flex">新的密码</span>
                    <input type="text">
                </div>
                <div>
                    <span class="flex">确认密码</span>
                    <input type="text">
                </div>
                <div>
                    <button>下一步</button>
                </div>
            </li>
            <li class="flex">
                <h2>
                    修改登录密码成功
                </h2>
                <span>
                    为了您的账号安全，修改密码成功后，将会退出账号，请重新登录！
                </span>
                <i class="iconfont">&#xe71e;</i>
                <button>
                    重新登录
                </button>
            </li>
        </ul>
    </template>

    <template id="email">
        <ul class="flex password email">
            <li class="flex">
                <div class="item item_1">（1）验证身份</div>
                <span></span>
                <div class="item item_2">（2）绑定邮箱</div>
                <span></span>
                <div class="item item_3">（3）绑定成功</div>
            </li>
            <li class="list" style="display: none">
                <div>
                    <span class="flex">绑定邮箱</span>
                    <input type="text">
                </div>
                <div>
                    <input type="text" placeholder="请输入验证码">
                    <input type="button" value="获取验证码">
                </div>
                <div>
                    <button>下一步</button>
                </div>
            </li>
            <li class="list">
                <div>
                    <input type="text" placeholder="请输入新的邮箱地址">
                </div>
                <div>
                    <input type="text" placeholder="请输入验证码">
                    <input type="button" value="获取验证码">
                </div>
                <div>
                    <button>下一步</button>
                </div>
            </li>
            <li class="flex" style="display: none">
                <h2>
                    修改登录密码成功
                </h2>
                <span>
                            为了您的账号安全，修改密码成功后，将会退出账号，请重新登录！
                        </span>
                <i class="iconfont">&#xe71e;</i>
                <button>
                    回到首页
                </button>
            </li>
        </ul>
    </template>

    <script>

        Vue.component('information',{
            template:'#information '
        })

        Vue.component('password',{
            template:'#password '
        })

        Vue.component('email',{
            template:'#email '
        })

        var vm=new Vue({
            el:'#content',
            data:{
                flag:'item1'
            },
            methods:{}
        });
    </script>

    <script>

        $(document).ready(function(){

            $("#poplayer").hide();

            $("#close").click(function(){
                $("#btnSave").addClass("layui-btn-disabled");
                $('.cropped').html('');
                $("#poplayer").hide();
            });

            $('#c_l li').click(function(){
                $('#c_l li').removeClass("select");
                $(this).addClass("select");
            });
        })

    </script>

    <script type="text/javascript" src="../../static/headPortrait/js/cropbox.js"></script>
    <script type="text/javascript">
        var blob;
        var file;
        $(window).load(function() {
            var options =
                {
                    thumbBox: '.thumbBox',
                    spinner: '.spinner',
                    imgSrc: '../../static/img/img1.jpg'
                }
            var cropper = $('.imageBox').cropbox(options);
            $('#upload-file').on('change', function(){
                $("#poplayer").show();
                var reader = new FileReader();
                reader.onload = function(e) {
                    options.imgSrc = e.target.result;
                    cropper = $('.imageBox').cropbox(options);
                }
                reader.readAsDataURL(this.files[0]);
                this.files = [];
            })
            $('#btnCrop').on('click', function(){
                var img = cropper.getDataURL();
                $('.cropped').html('');
                $('.cropped').append('<img src="'+img+'" align="absmiddle" id="size64" class="size"><p>64px</p>');
                $("#btnSave").removeClass("layui-btn-disabled");

                var obj=dataURLtoFile(img,"testImg");
                console.log(obj);

                $('.cropped').append('<img src="'+obj+'" align="absmiddle" id="size128" class="size"><p>128px</p>');
            })
            $('#btnZoomIn').on('click', function(){
                cropper.zoomIn();
            })
            $('#btnZoomOut').on('click', function(){
                cropper.zoomOut();
            })
        });
        function dataURLtoFile(dataurl, filename) {
            var arr = dataurl.split(',');
            var mime = arr[0].match(/:(.*?);/)[1];
            var bstr = atob(arr[1]);
            var n = bstr.length;
            var u8arr = new Uint8Array(n);
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            //转换成file对象
            return new File([u8arr], filename, {type:mime});
            //转换成成blob对象
            //return new Blob([u8arr],{type:mime});
        }
        //将图片转换为base64,再将base64转换成file对象

    </script>

</body>
</html>